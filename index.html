<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Startup Exchange Event Scheduler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .description {
            background: #f0f4ff;
            padding: 25px 30px;
            border-bottom: 2px solid #e0e0e0;
            color: #333;
            line-height: 1.6;
        }

        .description h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .controls {
            background: #f8f9fa;
            padding: 20px 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 2px solid #e0e0e0;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
        }

        select, input, button {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .schedule-grid {
            padding: 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr.past-row {
            display: none;
        }

        .time-slot {
            font-weight: 600;
            color: #667eea;
            background: #f8f9fa;
        }

        .company-slot {
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .company-slot:hover {
            background: #f0f4ff;
            transform: scale(1.02);
        }

        .company-slot.booked {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .company-slot.booked:hover {
            background: #f5f5f5;
            transform: scale(1);
        }

        .company-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .company-type {
            font-size: 0.85em;
            color: #666;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 5px;
        }

        .company-type.startup {
            background: #e3f2fd;
            color: #1976d2;
        }

        .company-type.vc {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .slots-info {
            font-size: 0.9em;
            color: #666;
        }

        .slots-available {
            color: #4caf50;
        }

        .slots-full {
            color: #f44336;
        }

        .booked-info {
            font-size: 0.85em;
            color: #ff9800;
            font-style: italic;
        }

        .booking-modal, .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .confirmation-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.3s ease;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header h2 {
            margin-bottom: 15px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        .form-group small {
            color: #999;
            font-size: 0.85em;
            margin-top: 3px;
            display: block;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn-cancel {
            background: #6c757d;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        /* Confirmation modal styles */
        .confirmation-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .confirmation-title {
            color: #4caf50;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .booking-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }

        .booking-details h3 {
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
        }

        .detail-value {
            color: #333;
        }

        .screenshot-reminder {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #ff9800;
        }

        .screenshot-reminder p {
            color: #e65100;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .screenshot-reminder small {
            color: #666;
        }

        .btn-close-confirmation {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
            font-weight: 600;
        }

        .btn-close-confirmation:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* Toast notification styles */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 2000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background: #4caf50;
        }

        .toast.error {
            background: #f44336;
        }

        .toast.warning {
            background: #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ Startup Exchange Event Scheduler</h1>
            <p>Talent Orbit Career Fair - Interview Scheduling System</p>
        </div>
        
        <div class="description">
            <h3>About Startup Exchange</h3>
            <p>An interactive networking experience inspired by the World CafÃ© model, designed to connect students with the startup and venture capital world. Through a series of rotating, small-group conversations, students will:</p>
            <ul style="margin: 10px 0 0 20px;">
                <li>Learn firsthand about the realities of launching and growing startups</li>
                <li>Explore career paths and job opportunities in the startup ecosystem</li>
                <li>Gain feedback and insights that can shape their own entrepreneurial ideas</li>
            </ul>
            <p style="margin-top: 10px;">Each table hosts a unique themeâ€”ranging from early-stage challenges to scaling strategies, investing, and startup careersâ€”creating space for open dialogue, practical advice, and authentic connections between students, founders, and investors.</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label>Select Day</label>
                <select id="daySelect">
                    <option value="day1">Day 1 - October 2</option>
                    <option value="day2">Day 2 - October 3</option>
                </select>
            </div>
        </div>

        <div class="schedule-grid" id="scheduleGrid">
            <div class="loading">Loading schedule...</div>
        </div>
    </div>

    <div class="booking-modal" id="bookingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Book Interview Slot</h2>
                <p id="modalInfo"></p>
            </div>
            <form id="bookingForm">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="studentName" required>
                </div>
                
                <div class="form-group">
                    <label>Student ID *</label>
                    <input type="text" id="studentId" required>
                </div>
                
                <div class="form-group">
                    <label>Student iMail *</label>
                    <input type="email" id="studentEmail" required pattern=".*@imail\.sunway\.edu$">
                    <small>Must end with @imail.sunway.edu</small>
                </div>
                
                <div class="form-group">
                    <label>School *</label>
                    <select id="studentSchool" required>
                        <option value="">Select your school</option>
                        <option value="FASS">Faculty of Arts & Social Sciences (FASS)</option>
                        <option value="FET">Faculty of Engineering & Technology (FET)</option>
                        <option value="FMLS">Faculty of Medical & Life Sciences (FMLS)</option>
                        <option value="SAE">School of American Education (SAE)</option>
                        <option value="SOE">School of Education (SOE)</option>
                        <option value="SHTM">School of Hospitality and Tourism Management (SHTM)</option>
                        <option value="SMS">School of Mathematical Sciences (SMS)</option>
                        <option value="SBS">Sunway Business School (SBS)</option>
                        <option value="Others">Others (specify below)</option>
                    </select>
                </div>
                
                <div class="form-group" id="otherSchoolGroup" style="display: none;">
                    <label>Specify Other School</label>
                    <input type="text" id="otherSchool">
                </div>
                
                <div class="form-group">
                    <label>Course of Study *</label>
                    <input type="text" id="studentCourse" required placeholder="E.g., BSc (Hons) Business Management">
                </div>
                
                <div class="form-group">
                    <label>Year of Study *</label>
                    <select id="studentYear" required>
                        <option value="">Select year</option>
                        <option value="Year 1">Year 1</option>
                        <option value="Year 2">Year 2</option>
                        <option value="Year 3">Year 3</option>
                        <option value="Year 4">Year 4</option>
                        <option value="Final Year">Final Year</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Contact Number *</label>
                    <input type="tel" id="studentPhone" required>
                </div>
                
                <div class="form-group">
                    <label>Personal Email</label>
                    <input type="email" id="personalEmail">
                    <small>In case you are unreachable at your Student iMail</small>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
                    <button type="submit">Confirm Booking</button>
                </div>
            </form>
        </div>
    </div>

    <div class="confirmation-modal" id="confirmationModal">
        <div class="confirmation-content">
            <div class="confirmation-icon">âœ…</div>
            <h2 class="confirmation-title">Booking Confirmed!</h2>
            
            <div class="booking-details">
                <h3>ðŸ“‹ Your Interview Details</h3>
                <div class="detail-row">
                    <span class="detail-label">Date:</span>
                    <span class="detail-value" id="confirmDate"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Time:</span>
                    <span class="detail-value" id="confirmTime"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Company:</span>
                    <span class="detail-value" id="confirmCompany"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Table:</span>
                    <span class="detail-value" id="confirmTable"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Student Name:</span>
                    <span class="detail-value" id="confirmName"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Student ID:</span>
                    <span class="detail-value" id="confirmId"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">School:</span>
                    <span class="detail-value" id="confirmSchool"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Course:</span>
                    <span class="detail-value" id="confirmCourse"></span>
                </div>
            </div>
            
            <div class="screenshot-reminder">
                <p>ðŸ“¸ Please take a screenshot of this confirmation!</p>
                <small>You'll need to show this at your interview.</small>
            </div>
            
            <button class="btn-close-confirmation" onclick="closeConfirmation()">Close</button>
        </div>
    </div>

    <script>
        // Configuration - Replace with your Google Sheets Web App URL
        const SHEETS_URL = 'https://script.google.com/macros/s/AKfycbwnN6EbYwCBegCTw1c5z7IXk1qtUhK4q03jLMq4AxAhH04fDvqbRTuGgkq4JyiPf7no/exec';
        
        // Company data
        const companies = {
            day1: [
                { name: "Block 71", type: "vc", table: 1 },
                { name: "TheHive Sea", type: "vc", table: 2 },
                { name: "Sunway iLabs", type: "vc", table: 3 },
                { name: "Arclab", type: "startup", table: 4 },
                { name: "Ourteam.ai", type: "startup", table: 5 },
                { name: "Growth Charger", type: "vc", table: 6 },
                { name: "AI engineer", type: "startup", table: 7 },
                { name: "gentech AI", type: "startup", table: 8 },
                { name: "Urban Farm Tech", type: "startup", table: 9 },
                { name: "Gobi Partners", type: "vc", table: 10 }
            ],
            day2: [
                { name: "Aonic", type: "startup", table: 1 },
                { name: "TheHive Sea", type: "vc", table: 2 },
                { name: "Sunway iLabs", type: "vc", table: 3 },
                { name: "SpeedHome", type: "startup", table: 4 },
                { name: "Arclab", type: "startup", table: 5 },
                { name: "Ourteam.ai", type: "startup", table: 6 },
                { name: "Growth Charger", type: "vc", table: 7 },
                { name: "Aurellia", type: "startup", table: 8 },
                { name: "Buzz", type: "startup", table: 9 },
                { name: "AI engineer", type: "startup", table: 10 },
                { name: "Urban Farm Tech", type: "startup", table: 11 },
                { name: "Gobi Partners", type: "vc", table: 12 }
            ]
        };

        // Bookings cache
        let bookingsCache = {};
        let lastFetchTime = 0;
        const CACHE_DURATION = 30000; // 30 seconds cache

        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Get time slots with 20-minute intervals (no buffer)
        function getTimeSlots() {
            let slots = [];
            let currentTime = new Date();
            currentTime.setHours(12, 30, 0); // Start at 12:30 PM
            const endTime = new Date();
            endTime.setHours(16, 0, 0); // End at 4:00 PM
            
            while (currentTime < endTime) {
                let startHour = currentTime.getHours();
                let startMin = currentTime.getMinutes();
                
                // Add 20 minutes for slot duration
                let endSlotTime = new Date(currentTime);
                endSlotTime.setMinutes(endSlotTime.getMinutes() + 20);
                
                let endHour = endSlotTime.getHours();
                let endMin = endSlotTime.getMinutes();
                
                let startStr = `${startHour.toString().padStart(2, '0')}:${startMin.toString().padStart(2, '0')}`;
                let endStr = `${endHour.toString().padStart(2, '0')}:${endMin.toString().padStart(2, '0')}`;
                
                slots.push(`${startStr} - ${endStr}`);
                
                // Move to next slot (20 minutes)
                currentTime.setMinutes(currentTime.getMinutes() + 20);
            }
            
            return slots;
        }

        // Check if a time slot has passed
        function isSlotPassed(slotTime, selectedDay) {
            const now = new Date();
            const [startTime] = slotTime.split(' - ');
            const [hours, minutes] = startTime.split(':').map(Number);
            
            // Get the date for the selected day
            const slotDate = new Date();
            if (selectedDay === 'day1') {
                slotDate.setMonth(9, 2); // October 2
            } else {
                slotDate.setMonth(9, 3); // October 3
            }
            slotDate.setHours(hours, minutes, 0, 0);
            
            // Add 20 minutes to get the end time
            const slotEndTime = new Date(slotDate);
            slotEndTime.setMinutes(slotEndTime.getMinutes() + 20);
            
            return now > slotEndTime;
        }

        // Load bookings from Google Sheets with caching
        async function loadFromSheets(forceRefresh = false) {
            const now = Date.now();
            
            // Use cache if available and not expired
            if (!forceRefresh && Object.keys(bookingsCache).length > 0 && (now - lastFetchTime) < CACHE_DURATION) {
                return true;
            }
            
            try {
                const response = await fetch(SHEETS_URL, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    bookingsCache = data.bookings || {};
                    lastFetchTime = now;
                    return true;
                } else {
                    throw new Error(data.error || 'Load failed');
                }
            } catch (error) {
                console.error('Load error:', error);
                showToast('Could not connect to booking system', 'error');
                return false;
            }
        }

        // Save booking to Google Sheets
        async function saveToSheets(bookingKey, booking) {
            try {
                const [day, slotIndex, table] = bookingKey.split('_');
                const companyList = companies[day];
                const company = companyList.find(c => c.table === parseInt(table));
                const companyName = company ? company.name : '';
                
                booking.company = companyName;
                
                const payload = {
                    action: 'add',
                    bookingKey: bookingKey,
                    booking: booking,
                    timestamp: new Date().toISOString()
                };
                
                const response = await fetch(SHEETS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                // Update local cache
                if (!bookingsCache[bookingKey]) {
                    bookingsCache[bookingKey] = [];
                }
                bookingsCache[bookingKey].push(booking);
                
                return true;
            } catch (error) {
                console.error('Save error:', error);
                showToast('Booking saved with warning: sync issue', 'warning');
                return false;
            }
        }

        // Load and display schedule
        async function loadSchedule() {
            await loadFromSheets();
            
            const day = document.getElementById('daySelect').value;
            const timeSlots = getTimeSlots();
            const companyList = companies[day];
            
            let html = '<table>';
            html += '<thead><tr><th>Time Slot</th>';
            
            companyList.forEach(company => {
                html += `<th>Table ${company.table}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            timeSlots.forEach((slot, slotIndex) => {
                const isPassed = isSlotPassed(slot, day);
                const rowClass = isPassed ? 'past-row' : '';
                
                html += `<tr class="${rowClass}">`;
                html += `<td class="time-slot">${slot}</td>`;
                
                companyList.forEach(company => {
                    const bookingKey = `${day}_${slotIndex}_${company.table}`;
                    const currentBookings = bookingsCache[bookingKey] || [];
                    const isBooked = currentBookings.length > 0;
                    
                    html += `<td class="company-slot ${isBooked ? 'booked' : ''}" 
                             onclick="${isBooked ? '' : `openBookingModal('${day}', ${slotIndex}, ${company.table})`}">`;
                    html += `<div class="company-name">${company.name}</div>`;
                    html += `<div class="company-type ${company.type}">${company.type.toUpperCase()}</div>`;
                    html += `<div class="slots-info">`;
                    if (isBooked) {
                        html += `<span class="slots-full">âœ— Booked</span>`;
                        if (currentBookings[0]) {
                            html += `<div class="booked-info">by ${currentBookings[0].name}</div>`;
                        }
                    } else {
                        html += `<span class="slots-available">âœ“ Available</span>`;
                    }
                    html += `</div>`;
                    html += `</td>`;
                });
                html += `</tr>`;
            });
            
            html += '</tbody></table>';
            document.getElementById('scheduleGrid').innerHTML = html;
        }

        // Handle school selection change
        document.getElementById('studentSchool').addEventListener('change', function() {
            const otherGroup = document.getElementById('otherSchoolGroup');
            const otherInput = document.getElementById('otherSchool');
            if (this.value === 'Others') {
                otherGroup.style.display = 'block';
                otherInput.required = true;
            } else {
                otherGroup.style.display = 'none';
                otherInput.required = false;
                otherInput.value = '';
            }
        });

        // Open booking modal
        function openBookingModal(day, slotIndex, tableNumber) {
            const companyList = companies[day];
            const company = companyList.find(c => c.table === tableNumber);
            const timeSlots = getTimeSlots();
            const bookingKey = `${day}_${slotIndex}_${tableNumber}`;
            const currentBookings = bookingsCache[bookingKey] || [];
            
            if (currentBookings.length > 0) {
                showToast('This slot is already booked. Please choose another time.', 'error');
                return;
            }
            
            const dateStr = day === 'day1' ? 'October 2' : 'October 3';
            
            document.getElementById('modalInfo').innerHTML = 
                `<strong>Company:</strong> ${company.name}<br>
                 <strong>Date:</strong> ${dateStr}<br>
                 <strong>Time:</strong> ${timeSlots[slotIndex]}<br>
                 <strong>Table:</strong> ${tableNumber}`;
            
            document.getElementById('bookingModal').style.display = 'flex';
            document.getElementById('bookingForm').dataset.bookingKey = bookingKey;
            document.getElementById('bookingForm').dataset.day = day;
            document.getElementById('bookingForm').dataset.slotIndex = slotIndex;
            document.getElementById('bookingForm').dataset.table = tableNumber;
        }

        // Close modal
        function closeModal() {
            document.getElementById('bookingModal').style.display = 'none';
            document.getElementById('bookingForm').reset();
            document.getElementById('otherSchoolGroup').style.display = 'none';
        }

        // Show confirmation modal
        function showConfirmation(bookingData) {
            const day = bookingData.day;
            const slotIndex = bookingData.slotIndex;
            const tableNumber = bookingData.table;
            const companyList = companies[day];
            const company = companyList.find(c => c.table === parseInt(tableNumber));
            const timeSlots = getTimeSlots();
            const dateStr = day === 'day1' ? 'October 2' : 'October 3';
            
            document.getElementById('confirmDate').textContent = dateStr;
            document.getElementById('confirmTime').textContent = timeSlots[slotIndex];
            document.getElementById('confirmCompany').textContent = company.name;
            document.getElementById('confirmTable').textContent = tableNumber;
            document.getElementById('confirmName').textContent = bookingData.name;
            document.getElementById('confirmId').textContent = bookingData.studentId;
            document.getElementById('confirmSchool').textContent = bookingData.school;
            document.getElementById('confirmCourse').textContent = bookingData.course;
            
            document.getElementById('confirmationModal').style.display = 'flex';
        }

        // Close confirmation modal
        function closeConfirmation() {
            document.getElementById('confirmationModal').style.display = 'none';
            loadSchedule(); // Refresh the schedule
        }

        // Handle booking form submission
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const bookingKey = this.dataset.bookingKey;
            const day = this.dataset.day;
            const slotIndex = this.dataset.slotIndex;
            const table = this.dataset.table;
            
            const schoolValue = document.getElementById('studentSchool').value;
            const finalSchool = schoolValue === 'Others' 
                ? document.getElementById('otherSchool').value 
                : schoolValue;
            
            const booking = {
                name: document.getElementById('studentName').value,
                studentId: document.getElementById('studentId').value,
                email: document.getElementById('studentEmail').value,
                school: finalSchool,
                course: document.getElementById('studentCourse').value,
                year: document.getElementById('studentYear').value,
                phone: document.getElementById('studentPhone').value,
                personalEmail: document.getElementById('personalEmail').value,
                timestamp: new Date().toISOString()
            };
            
            // Save to sheets
            await saveToSheets(bookingKey, booking);
            
            // Close booking modal
            closeModal();
            
            // Show confirmation modal
            showConfirmation({
                ...booking,
                day: day,
                slotIndex: slotIndex,
                table: table
            });
        });

        // Initialize on load
        window.addEventListener('DOMContentLoaded', function() {
            loadSchedule();
            
            // Auto-refresh every 60 seconds (reduced from 120)
            setInterval(() => {
                loadFromSheets(true).then(() => loadSchedule());
            }, 60000);
        });
        
        document.getElementById('daySelect').addEventListener('change', function() {
            loadSchedule();
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target === document.getElementById('bookingModal')) {
                closeModal();
            }
            if (e.target === document.getElementById('confirmationModal')) {
                closeConfirmation();
            }
        });
    </script>
</body>
</html>
